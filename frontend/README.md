# Frontend for URL Shortener

Веб-приложение для сокращения URL-адресов с аутентификацией через Keycloak.

## Технологический стек

- **React 18** - UI библиотека
- **TypeScript** - типизированный JavaScript
- **Vite** - сборщик и dev-сервер
- **React Router 6** - маршрутизация
- **Keycloak JS** - клиент для аутентификации
- **Axios** - HTTP клиент

## Структура проекта

```
frontend/
├── src/
│   ├── App.tsx          # Главный компонент с роутингом
│   ├── main.tsx         # Точка входа приложения
│   ├── api.ts           # API клиент (Axios)
│   ├── keycloak.ts      # Конфигурация Keycloak
│   ├── config.ts        # Конфигурация приложения
│   ├── styles.css       # Глобальные стили
│   └── env.d.ts         # TypeScript типы для env переменных
├── public/
│   └── silent-check-sso.html  # Silent SSO проверка
├── config.ts            # Конфигурация
├── vite.config.ts       # Конфигурация Vite
├── package.json         # Зависимости
└── tsconfig.json        # TypeScript конфигурация
```

## Функциональность

### Страницы

1. **Главная (`/`)** - отображает информацию о текущем пользователе:
   - Имя (given_name, middle_name, family_name)
   - Email
   - Телефон
   - Адрес
   - Пол

2. **Создать короткую ссылку (`/shorten`)** - форма для создания коротких ссылок:
   - Ввод оригинального URL
   - Создание короткой ссылки через API
   - Отображение результата (короткая и оригинальная ссылки)

3. **Мои ссылки (`/links`)** - управление созданными ссылками:
   - Список всех ссылок пользователя
   - Информация о каждой ссылке (код, короткая ссылка, оригинальная, клики, дата создания)
   - Возможность удаления ссылок
   - Кнопка обновления списка

### Аутентификация

- Автоматическая аутентификация через Keycloak при загрузке приложения
- Режим `login-required` - пользователь должен войти для доступа
- Автоматическое обновление токена каждые 10 секунд
- Токен сохраняется в localStorage
- Автоматическая установка токена в заголовок `Authorization: Bearer <token>` для всех API запросов

## Запуск в dev-режиме

### 1. Установите зависимости:

```bash
cd frontend
npm install
```

### 2. Настройте переменные окружения (опционально):

Создайте файл `.env` в корне проекта `frontend/`:

```env
VITE_PLATFORM_URL=http://localhost:3000
VITE_AUTH_URL=https://auth.dev.hr.alabuga.space
VITE_PLATFORM_ID=alb-start
VITE_BACKEND_URL=http://localhost:8080
```

### 3. Запустите dev-сервер:

```bash
npm run dev
```

Приложение откроется на `http://localhost:3001` (или следующем свободном порту, если 3001 занят).

### Прокси-настройки

Vite автоматически проксирует следующие пути на бэкенд (`http://localhost:8080`):
- `/api/*` → API endpoints
- `/swagger-ui/*` → Swagger UI
- `/api-docs/*` → API документация

## Продакшен сборка

### Сборка:

```bash
npm run build
```

Артефакты будут в директории `dist/`.

### Предпросмотр продакшен сборки:

```bash
npm run preview
```

## Переменные окружения

| Переменная | Описание | Значение по умолчанию |
|------------|----------|----------------------|
| `VITE_PLATFORM_URL` | URL платформы для редиректа | `http://localhost:3000` |
| `VITE_AUTH_URL` | URL Keycloak сервера | `https://auth.dev.hr.alabuga.space` |
| `VITE_PLATFORM_ID` | ID клиента в Keycloak | `alb-start` |
| `VITE_BACKEND_URL` | URL бэкенд API сервера | `http://localhost:8080` |

**Важно:** Все переменные окружения должны начинаться с `VITE_` чтобы быть доступными в коде.

## API Endpoints

Приложение использует следующие API endpoints:

- `POST /api/shorten` - создание короткой ссылки
  ```json
  { "url": "https://example.com" }
  ```

- `GET /api/my-links` - получение списка ссылок пользователя

- `DELETE /api/links/{code}` - удаление ссылки по коду

- `GET /api/stats/{code}` - статистика по ссылке (реализовано, но не используется в UI)

Все запросы требуют аутентификации через Bearer JWT токен.

## Конфигурация Keycloak

Приложение настроено для работы с Keycloak realm `Alabuga` и client `alb-start`.

**Настройки Keycloak:**
- Realm: `Alabuga`
- Client ID: `alb-start` (или значение из `VITE_PLATFORM_ID`)
- Authentication flow: `login-required` (обязательный вход)

## Особенности реализации

- **Автоматическое обновление токенов**: токен обновляется каждые 10 секунд с запасом в 70 секунд до истечения
- **Хранение токенов**: токены сохраняются в localStorage
- **Обработка ошибок**: все API ошибки отображаются пользователю
- **Загрузочные состояния**: индикаторы загрузки для всех асинхронных операций
- **Темная тема**: приложение использует темную цветовую схему

## Разработка

### Структура компонентов

- `App.tsx` - главный компонент с роутингом
  - `Header` - навигационная панель
  - `Home` - главная страница с информацией о пользователе
  - `Shorten` - страница создания коротких ссылок
  - `Links` - страница управления ссылками

### API клиент

`api.ts` предоставляет:
- `createShort(url)` - создание короткой ссылки
- `myLinks()` - получение списка ссылок
- `deleteByCode(code)` - удаление ссылки
- `statsByCode(code)` - получение статистики
- `setToken(token)` - установка JWT токена для авторизации

### Keycloak интеграция

`keycloak.ts` управляет:
- Инициализацией Keycloak клиента
- Аутентификацией пользователя
- Обновлением токенов
- Хранением токенов в localStorage

## Требования

- Node.js 18+ 
- npm или yarn

## Лицензия

Private project
